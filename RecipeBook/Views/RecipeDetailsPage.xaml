<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:converters="clr-namespace:RecipeBook.Converters"
             x:Class="RecipeBook.Views.RecipeDetailsPage"
             Title="Recipe Details"
             BackgroundColor="{StaticResource BackgroundColor}">

    <ContentPage.Resources>
        <converters:Base64ToImageConverter x:Key="Base64ToImageConverter" />
        <converters:StringToBoolConverter x:Key="StringToBoolConverter" />
        <converters:BoolToFavoriteTextConverter x:Key="BoolToFavoriteTextConverter" />
        <converters:BoolToFavoriteColorConverter x:Key="BoolToFavoriteColorConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <!-- Изображение рецепта -->
            <Frame IsClippedToBounds="True"
                   CornerRadius="20"
                   Padding="0"
                   HeightRequest="200"
                   BackgroundColor="{StaticResource CardBackground}"
                   HasShadow="True"
                   IsVisible="{Binding Recipe.ImageBase64, Converter={StaticResource StringToBoolConverter}}">
                <Image Aspect="AspectFill"
                       Source="{Binding Recipe.ImageBase64, Converter={StaticResource Base64ToImageConverter}}" />
            </Frame>

            <!-- Заголовок -->
            <Label Text="{Binding Recipe.Title}"
                   FontSize="24"
                   FontAttributes="Bold"
                   TextColor="{StaticResource PrimaryAccent}"
                   HorizontalOptions="Center" />

            <!-- Описание -->
            <Frame BackgroundColor="{StaticResource CardBackground}"
                   CornerRadius="16"
                   Padding="15"
                   HasShadow="True">
                <Label Text="{Binding Recipe.Description}"
                       FontSize="16"
                       TextColor="{StaticResource TextColor}" />
            </Frame>

            <!-- Ингредиенты -->
            <Label Text="Ingredients"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="{StaticResource SecondaryAccent}"
                   Margin="0,10,0,0" />

            <CollectionView ItemsSource="{Binding Recipe.Ingredients}">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="5"
                              ColumnDefinitions="*, Auto">
                            <Label Text="{Binding Name}" Grid.Column="0"
                                   TextColor="{StaticResource TextColor}" />
                            <Label Text="{Binding Quantity}" Grid.Column="1"
                                   TextColor="{StaticResource TextColor}" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Шаги -->
            <Label Text="Steps"
                   FontSize="20"
                   FontAttributes="Bold"
                   TextColor="{StaticResource SecondaryAccent}"
                   Margin="0,10,0,0" />

            <ListView ItemsSource="{Binding Recipe.Steps}"
                      HasUnevenRows="True"
                      SeparatorVisibility="None"
                      SelectionMode="None">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <Frame BackgroundColor="{StaticResource CardBackground}"
                                   CornerRadius="12"
                                   Padding="10"
                                   Margin="0,0,0,10"
                                   HasShadow="False">
                                <Grid ColumnDefinitions="Auto, *">
                                    <Label Text="•"
                                           FontSize="18"
                                           TextColor="{StaticResource PrimaryAccent}" />
                                    <Label Text="{Binding Text}"
                                           Grid.Column="1"
                                           FontSize="16"
                                           TextColor="{StaticResource TextColor}"
                                           Margin="5,0,0,0" />
                                </Grid>
                            </Frame>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <!-- Кнопки -->
            <VerticalStackLayout>
                <HorizontalStackLayout HorizontalOptions="Center"
                                   Spacing="10"
                                   Margin="0,20,0,10">
                    <Button Text="{Binding IsFavorite, Converter={StaticResource BoolToFavoriteTextConverter}}"
                        Command="{Binding ToggleFavoriteCommand}"
                        BackgroundColor="{Binding IsFavorite, Converter={StaticResource BoolToFavoriteColorConverter}}"
                        TextColor="White"
                        CornerRadius="10"
                        WidthRequest="120" />

                    <Button Text="Edit"
                        Command="{Binding EditRecipeCommand}"
                        IsVisible="{Binding IsOwner}"
                        BackgroundColor="{StaticResource SecondaryAccent}"
                        TextColor="White"
                        CornerRadius="10"
                        WidthRequest="120" />
                </HorizontalStackLayout>

                <Button Text="Delete"
                        Command="{Binding DeleteRecipeCommand}"
                        IsVisible="{Binding IsOwner}"
                        BackgroundColor="{StaticResource ButtonColor}"
                        TextColor="White"
                        CornerRadius="10"
                        WidthRequest="220" />
            </VerticalStackLayout>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
